 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=7" />
<title>启动网 - 畅游网络，从此启动！</title>

    <link href="style/css/style.css" rel="stylesheet" type="text/css" />
    <link href="js/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
	html { overflow-y:auto; }
	.over{
			background:#FBEC88;
			border:2px solid #FBEC88;
		}
	</style>
    
    <script src="js/jquery-1.4.2.min.js" type="text/javascript"></script>
    <script src="js/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="js/jquery.cookie.js" type="text/javascript"></script>
    <script src="js/common.js" type="text/javascript"></script>
    <script src="js/index.js" type="text/javascript"></script>
    <script type="text/javascript">
		
		$(document).ready(function(){
            initThumbUrl();
		});
		
		/*
		function enableEditThumbURL()
		{
				$('.thumbURL dl').draggable({
						revert:true,
						proxy:'clone',
						handle:'.title'
				}).droppable({
					onDragEnter:function(){
						$(this).addClass('over');
					},
					onDragLeave:function(){
						$(this).removeClass('over');
					},
					onDrop:function(e,source){
						$(this).removeClass('over');
						var src = $(source).children().clone();	//复制源子元素
						var thi = $(this).children().clone();	//复制this元素
						$(this).empty().append(src);
						$(source).empty().append(thi);
					}
				});
		}
		
		
		function disableEditThumbURL(){
			$('.thumbURL dl').disable();
			alert("Disable OK!");
		}
		*/
		

		
		//初始化URL数据
		function initThumbUrl()
		{
		     var datThumbUrl = getCookie("ThumbUrl");
		    
		    if(!datThumbUrl)
		    {
		        AjaxLoadThumbUrl();
		    }
		    else
		    {
		        FillThumbUrl(eval(datThumbUrl));
		    }
		}
		
		
		//异步取URL数据
        function AjaxLoadThumbUrl(){
            $.ajax({
               type: "GET",
               url: "Ajax/GetThumbUrlList.aspx?UserID=2&ramdom=" + parseInt(Math.random() * 9999 + 1).toString(),
               data: "",
               dataType: "text",
               success: function(data){
                 data = data.replace(/\n/g,"").replace(/\r/g,"").replace(/\s/g,""); //过滤掉\r\n\空格等字符
                 setCookie('ThumbUrl', data);  //存储
                 FillThumbUrl(eval(data));
                 
               },
               error: function(XMLHttpRequest, textStatus, errorThrown) 
               {
                    alert("出错啦，请稍候再试！");
               }
            });
        }
		
		//保存URL数据
		function saveThumbUrl(){
		    var strJson = "";
		    $("#thumbURL dl").each(function(i){
		        var title = $(this).find(".title").html();
		        var img = $(this).find(".img img").attr("src");
		        var url = $(this).find(".img a").attr("href");
		        var target = $(this).find(".img a").attr("target");
		        
		        if(!url) return true;
		        if(!title) title = "";
		        if(!img) img = "";
		        if(!target) target = "";
		        
		        if(i > 0){
		            strJson += " ,";
		        }
		        
		        strJson += "{'title':'" + title + "', 'img':'" + img + "', 'url':'"+ url +"', target:'"+ target +"'}"
		    });
		    strJson = "[" + strJson + "]";
		    delCookie("ThumbUrl");  //删除
		    setCookie("ThumbUrl", strJson); //添加
		    
		    
		    //提示保存成功
		    $.messager.show({title:"温馨提示—启动网",msg:"恭喜您，您编辑并保存成功！"});
		    $("#saveThumbUrl").hide();  //隐藏保存
		}
		
		//取得Json数据，将数据进行填充
		function FillThumbUrl(data){
				/* 2010-12-10 0:04:36 */
		        var thumHtml = "<div class=\"thumbURL\">";
		        
                for(var i = 0; i < data.length; i++)
                {
                    if(!data[i].title)  data[i].title="启动网";
                    if(!data[i].url) data[i].url = "http://www.7dong.net";
                    if(!data[i].img) data[i].img = "style/images/thumburl/nopic.jpg";
                    
		            thumHtml += "<dl>";
		            thumHtml += "  <dt class=\"title\">"+ data[i].title +"</dt>";
		            thumHtml += "  <dd class=\"img\">";
		            var tagert = ""
		            if(!data[i].target || data[i].target  == "")
		            {
		                thumHtml += "  <a href=\""+ data[i].url +"\" target=\"_blank\">";
		            }
		            else
		            {
		                thumHtml += "  <a href=\""+ data[i].url +"\" target=\""+ data[i].target +"\">";
		                
		            }
		            
		            thumHtml += "    <img src=\""+ data[i].img +"\"  alt=\""+ data[i].title +"\" />";
		            thumHtml += "  </a>";
		            thumHtml += "  </dd>"
		            thumHtml += "</dl>";
                }
    		    
		        thumHtml += "</div>"
    		    
		        $("#thumbURL").html(thumHtml);
				
				$('.thumbURL dl').draggable({
						revert:true,
						proxy:'clone',
						handle:'.title'
				}).droppable({
					onDragEnter:function(){
						$(this).addClass('over');
					},
					onDragLeave:function(){
						$(this).removeClass('over');
					},
					onDrop:function(e,source){
						$(this).removeClass('over');
						var src = $(source).children().clone();	//复制源子元素
						var thi = $(this).children().clone();	//复制this元素
						$(this).empty().append(src);
						$(source).empty().append(thi);
						$(this).draggable({
							revert:true,
							proxy:'clone',
							handle:'.title'
						});
						$(source).draggable({
							revert:true,
							proxy:'clone',
							handle:'.title'
						});
						
						//提示保存
						$("#saveThumbUrl").show();
					}
				});

		}
		
		
	
    </script>
    
</head>

<body>

    <div id="desktop">
	        <div id="topBar">
        	<div class="topCenter">
                 <div id="logo">
                    <a href="Index.html"><img src="style/Images/miniLogo.gif" width="45" style="border:0px;" /></a>
                 </div>
                 <div id="nav"> 
                  <ul> 
                    <li><a href="index.html"><img src="style/images/icons/home.png" height="40" title="主页" width="40"/></a></li> 
                    <li><a href="index.html"><img src="style/images/icons/portfolio.png" title="收藏" height="40" /></a></li> 
                    <li><a href="index.html"><img src="style/images/icons/link.png" title="常用网址" height="40" /></a></li> 
                    <li><a href="index.html"><img src="style/images/icons/history.png" title="历史" height="40" /></a></li> 
                    <li><a href="index.html"><img src="style/images/icons/calendar.png" title="日历" height="40" /></a></li> 
                    <li><a href="index.html"><img src="style/images/icons/rss.png" title="阅读" height="40" /></a></li> 
                    <li><a href="index.html"><img src="style/images/icons/music.png" title="音乐" height="40" /></a></li> 
                    <li><a href="index.html"><img src="style/images/icons/video.png" title="视频" height="40" /></a></li>
                    <li><a href="index.html"><img src="style/images/icons/email.png" title="邮箱" height="40" /></a></li>
                    <li class="txt"><a href="#">登录</a></li>
                    <li class="txt"><a href="#url=User/Register.aspx&title=新用户注册" onclick="loadRegisterWin();">注册</a></li>
                    <!--<li class="txt"><a href="#">控制面板</a></li>-->
                    <!--<li class="txt"><a href="#" onclick="delCookie('ThumbUrl'); alert('清除成功！'); /*enableEditThumbURL();*/">配置首页</a></li>
                    <li class="txt"><a href="#" onclick="getThumbUrl();/*disableEditThumbURL();*/">保存配置</a></li>-->
                    <li class="txt" id="saveThumbUrl" style="display:none;"><a href="#" onclick="saveThumbUrl();">保存</a></li>
                    <!--<li class="txt"><a href="#" onclick="initThumbUrl();">重置</a></li>
                    <li class="txt"><a href="#" onclick="delCookie('ThumbUrl'); alert('清除成功！');">清除</a></li>-->
                  </ul> 
                </div>
                <div class="clear"></div>
            </div>
        </div>
        
        
        <div id="mainPanel">
        
	        <div class="thumbURL" id="thumbURL">
    	        <dl>
        	        <dt class="title">启动网</dt>
                    <dd class="img">
                        <a href="http://www.7dong.net" target="_blank"><img src="style/images/img1.png"  alt="http://www.7dong.net" /></a>
                    </dd>
                </dl>
                <div class="clear"></div>
            </div>
        
        </div>
        

        
        <div id="footBar">
            <div id="statusBar"></div>
        </div>
    </div>



    
    
    <div id="window" >
    </div>
    
    <div class="messager" id="messager">
    </div>

    
</body>
</html>
